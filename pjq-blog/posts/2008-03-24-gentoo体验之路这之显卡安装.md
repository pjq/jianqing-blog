---
title: "Gentoo体验之路这之显卡安装"
date: 2008-03-24
author: pengjianqing
categories: ['gentoo']
---

首先要配置内核

打开内核模块加载的支持
```
Loadable module support --->
  [*] Enable loadable module support
```

```

你还要在内核中打开Memory Type Range Register
```

```

Processor and Features --->
  [*] MTRR (Memory Type Range Register) suppor
```

```

```

```
打开agpgart支持
```

```
Device Drivers --->
 Character devices --->
   /dev/agpgart (AGP Support)
```

```

```

```
去掉内核中的驱动
```

```
Device Drivers --->
Graphics Support --->
   nVidia Framebuffer Support
   nVidia Riva support
```

```

```

```
打开VESA支持
```

```
Device Drivers --->
 Graphics Support --->
  [*]   VESA VGA graphics support
```

```
打开uvesafb支持
```

```
Device Drivers --->
Graphics Support --->
   Userspace VESA VGA graphics support
```

```

```

```
然后安装驱动
```

```
emerge nvidia-drivers nvidia-settings
```

```
lsmod | grep nvidia && rmmod nvidia
```

```
modprobe nvidia
```

```

```

vim /etc/modules.autoload.d/kernel-2.6
```
 加入:nvidia
```

```
update-modules
```

```

```

```
配置X服务
```

```
vim /etc/X11/xorg.conf
```

在X服务配置中把nv改成nvidia
```
Section "Device"
  Identifier "nVidia Inc. GeForce2"
  Driver     "nvidia""
  VideoRam   65536
```

```
EndSection
```

```

```

```

然后到Module一节，确认glx模块加载，同时dri模块没加载：
```

```
 Section "Module"
  （……）
  # Load  "dri"
  Load  "glx"
  （……）
EndSection
```

```

下一步，在Screen一节，确保DefaultDepth指令被设为16或24,或者你只有
Depth设为16或24的Display小节。如果不这样做，nVidia的GLX扩展将无法启动。
```

```
Section "Screen"
  （……）
  DefaultDepth 16
  Subsection "Display"
  （……）
EndSection
```

```

```

运行eselect，让X服务使用nVidia的GLX库:
```
eselect opengl set nvidia
```

```

```

```
把你的用户加入video组
gpasswd -a youruser video
```

检查直接渲染状态
```
glxinfo | grep direct
direct rendering: Yes
```

```

```

```
**重要: **
每次你[编译新内核](///doc/en/kernel-upgrade.xml)或重新编译当前内核，你需要运行emerge nvidia-drivers重新安装nVidia模块。
```

```
一个更容易的保持由ebuild安装的模块可用的方式是安装sys-kernel/module-rebuild。
```

```
一旦你已经安装了它，
```

```
简单地运行module-rebuild populate以把一个需要重新编译的包列表populate到数据库中。
```

```
仅仅运行module-rebuild rebuild来为你的新内核重建驱动就行了。
```

```

```

```

```

```

```

```

```