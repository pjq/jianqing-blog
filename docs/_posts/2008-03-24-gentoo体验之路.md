---
title: "Gentoo体验之路"
date: 2008-03-24
author: pengjianqing
categories: ['gentoo']
---

最近有时间，下了gentoo来体验一下。

看了安装相关文档：http://www.gentoo-cn.org/doc/zh_cn/index.xml

http://www.gentoo-cn.org/doc/zh_cn/index.xml?catid=install

然后找了个教育网，我这里也只有http://ftp.sjtu.edu.cn 下载比较快，

下载LiveCD:http://ftp.sjtu.edu.cn/gentoo/releases/x86/2007.0/livecd/livecd-i686-installer-2007.0.iso

也可以下载：http://ftp.sjtu.edu.cn/gentoo/releases/x86/2007.0/installcd/install-x86-minimal-2007.0-r1.iso

刚开始用minimal从硬盘安装，总是提示找不到 镜像文件，只好改用livecd了

硬盘安装方法：先将livecd解压到一个分区的根目录下，最好是fat32，（NTFS没试过 ），

然后用grub引导：

修改 menu.lst文件

title gentoo install
root (hd0,6)
kernel /isolinux/gentoo root=/dev/ram0 init=/linuxrc  dokeymap looptype=squashfs loop=/image.squashfs  cdroot initrd=gentoo.igz vga=791 splash=silent,theme:livecd-2006.1 CONSOLE=/dev/tty1 quiet
initrd /isolinux/gentoo.igz
boot

说明一下，我将livecd解压到XP下的F盘了，对应的是/dev/sda7,但root 里要减1,就是(hd0,6)了

接着就从livecd启动了：参考安装手册：
# Gentoo Linux x86快速安装指南http://www.gentoo-cn.org/doc/zh_cn/gentoo-x86-quickinstall.xml

由于我是教育网，从上海交大FTP上下载比较快，所以就从网上直接下载安装相关文件了，尽管它是livecd

启动后，打开一个终端

sudo passwd

修改密码，这样就可以

su root了

切换到root 之后，第一件事就是配置网络了

这里就略过了。
```
net-setup eth0
```

```
这时就可以启动sshd了
```

```
 /etc/init.d/sshd start
```

```
用passwd修改密码，然后从另外一台电脑上ssh了
```

```

```

```
然后就是分区了
```

```
/dev/sda8   /boot
```

```
/dev/sda9   /
```

```
/dev/sda10   swap
```

```
（ext2完全满足/boot分区的需要）

livecd ~ # mke2fs /dev/sda8（主分区就用ext3吧）

livecd ~ # mke2fs -j /dev/sda9

（创建并激活交换分区）

livecd ~ # mkswap /dev/sda10 && swapon /dev/sda10
```

```
挂载文件系统
```

```
livecd ~ # mount /dev/sda9 /mnt/gentoo   #挂载根目录

livecd ~ # mkdir /mnt/gentoo/boot      #创建BOOT目录

livecd ~ # mount /dev/sda8 /mnt/gentoo/boot  #/boot目录

livecd ~ # cd /mnt/gentoo         #切换到gentoo目录
```

```
安装Stage
```

date MMDDhhmmYYYY

下载stage3

wget  http://ftp.sjtu.edu.cn/gentoo/releases/x86/current/stages/stage3-x86-2007.0.tar.bz2

tar xvjpf stage3*

然后：cd /mnt/gentoo/usr

下载最新portage快照；

wget http://ftp.sjtu.edu.cn/gentoo/snapshots/portage-latest.tar.bz2
```
 解压:tar xvjf portage-lat*
```

```
切换系统（chroot）
```

```
livecd usr # cd /

livecd / # mount -t proc proc /mnt/gentoo/proc

livecd / # cp -L /etc/resolv.conf /mnt/gentoo/etc/

livecd / # chroot /mnt/gentoo /bin/bash

livecd / # env-update && source /etc/profile
```

```
cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 以后设置也行
```

```
装载内核，这个时候最好修改一下/etc/make.conf
```

```
加入速度最快的镜像GENTOO_MIRRORS：（这是我现在的make.conf）
```

```
# These settings were set by the catalyst build script that automatically

# built this stage.

# Please consult /etc/make.conf.example for a more detailed example.

HTTP_PROXY="210.29.96.35:80"

CFLAGS="-O2 -march=i686 -pipe"

CXXFLAGS="${CFLAGS}"

# This should not be changed unless you know exactly what you are doing.  You

# should probably be using a different stage, instead.

LINGUAS="en"

CHOST="i686-pc-linux-gnu"

SYNC="rsync://ftp.tsinghua.edu.cn/pub/mirror/gentoo/gentoo-portage"

GENTOO_MIRRORS="http://ftp3.tsinghua.edu.cn/pub/mirror/gentoo/  http://ftp.sjtu.edu.cn/gentoo"

USE="pdf xv dvd opengl xv png real nv jpeg win32codecs mp3 nvidia wma hal avahi xvmc  alsa midi -debug -test hda-intel X nptl -ipv6 -fortran unicode svg  dbus -kde -qt3 -qt4 -arts -eds gnome gtk firefox"

CCACHE_SIZE="2G"

ALSA_CARDS="Intel HD Audio"

VIDEO_CARDS="nvidia"
```

```

```

```
 设置好代理：export http_proxy="210.29.96.35:80"
```

```
emerge gentoo-sources
```

```
cd /usr/src/linux/
```

```
make menuconfig
```

```
配置内核：
```

```
注意：1.要加入对sata硬盘的支持，否则有可能无法启动
```

```

```

```

```

```

```

2.网卡支持

3.加入到文件系统的支持,ext2,ext3,fat,ntfs

4.声卡，显卡,稍后再说
```
livecd linux # make modules_install

livecd linux # cp arch/i386/boot/bzImage /boot/kernel
```

```
配置系统：
```

```
cd /etc
```

```
emerge vim
```

```
emerge ntfs3g #支持ntfs读写
```

```
vim fstab
```

```
(我现在的fstab文件，)
```

```
 # NOTE: If your BOOT partition is ReiserFS, add the notail option to opts.

/dev/sda9               /               ext3            noatime 0 1

/dev/sda8              /boot           ext2             noatime 1 2

#/dev/sda9              /               ext3            noatime         0 1

/dev/sda10              none            swap            sw              0 0

/dev/cdrom              /mnt/cdrom      audo            noauto,ro       0 0

#/dev/fd0               /mnt/floppy     auto            noauto          0 0

/dev/sda1    /media/sda1      ntfs-3g    defaults,locale=zh_CN.UTF-8  0   0

/dev/sda5   /media/sda5       ntfs-3g    defaults,locale=zh_CN.UTF-8   0  0

/dev/sda6    /media/sda6     vfat      defaults,iocharset=utf8   0   0

/dev/sda7     /media/sda7    vfat      defaults,iocharset=utf8   0   0

/dev/sda11     /media/sda11  ext3     noatime        0  0
```

```

```

```
配置网络
```

```
cd /etc/conf.d
```

```
vim net 加入:
```

```
config_eth0=("10.0.1.112/24")

routes_eth0=("default via 10.0.1.1")
```

```
rc-update add net.eth0 default #启动时自动运行
```

```
如果网卡驱动编译为模块，需要将安添加到
```

```
/etc/modules.autoload.d/kernel-2.6
```

```
（如果希望重启后通过ssh重新连接到新机器）

livecd conf.d # rc-update add sshd default
```

```
 设置root密码
```

```
livecd conf.d # passwd

New UNIX password: 输入密码

Retype new UNIX password: 再输入密码

passwd: password updated successfully
```

```

```

```
设置时区
```

```
livecd conf.d # nano -w /etc/conf.d/clock

TIMEZONE="Asia/Shanghai"
```

安装系统日志和cron守护进程：
```
emerge syslog-ng vixie-cronlivecd
```

```
livecd conf.d # rc-update add syslog-ng default

livecd conf.d # rc-update add vixie-cron default
```

```

```

```
livecd conf.d # emerge xfsprogs       （如果使用XFS文件系统）

livecd conf.d # emerge jfsutils       （如果使用JFS文件系统）

livecd conf.d # emerge reiserfsprogs  （如果使用Reiser文件系统）

livecd conf.d # emerge dhcpcd         （如果使用DHCP客户端）

livecd conf.d # emerge ppp            （如果使用PPPoE ADSL连接）
```

```

```

```
配置grub
```

```
emerge grub
```

```
vim /boot/grub/grub.conf
```

```
title Gentoo

root (hd0,7)

kernel /boot/kernel root=/dev/sda9 splash quiet
```

```

```

```
grub
```

```
root (hd0,7)#多试几个就知道了
```

```
setup (hd0)
```

```
quit
```

```
这样基本系统就安装完了
```

```
livecd conf.d # exit

livecd / # umount /mnt/gentoo/proc /mnt/gentoo/boot /mnt/gentoo

livecd / # reboot
```

```

```

```
添加一个新用户: adduser -g users -G lp,wheel,audio,cdrom,portage,cron -m john
```

```
passwd john
```

```
定义语言环境
```

vim /etc/locale.gen

emerge ccache
```

```

```

```

```

```

```

```

```

```